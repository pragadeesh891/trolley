<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shopping Voice Assistant</title>
</head>
<body>
  <h1>Shopping Voice Assistant</h1>
  <p>Say an item name (milk, bread, rice, fruits) and then say "next" for each step.</p>
  <button id="start-btn">Start Assistant</button>

  <script>
    // ------------ Data ------------
    const storeMap = {
      milk: [
        "Start at the entrance",
        "Go straight for 10 meters",
        "Turn left at the second aisle",
        "Milk will be on your right"
      ],
      bread: [
        "Start at the entrance",
        "Go straight for 5 meters",
        "Turn right at the first aisle",
        "Bread will be on your left"
      ],
      rice: [
        "Start at the entrance",
        "Walk to the last aisle",
        "Turn left",
        "Rice section will be in the middle shelves"
      ],
      fruits: [
        "Start at the entrance",
        "Go straight",
        "Fruits section is right in front of you near the billing area"
      ]
    };

    const availableItems = Object.keys(storeMap); // for suggestions
    let currentItem = "";
    let currentStep = 0;

    // ------------ Speech Synthesis ------------
    function speak(text) {
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(text);
      utter.rate = 1;
      synth.speak(utter);
      console.log("AI:", text);
    }

    // ------------ Speech Recognition ------------
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = "en-US";
    recognition.interimResults = false;

    recognition.onresult = function (event) {
      const transcript = event.results[0][0].transcript.toLowerCase();
      console.log("You said:", transcript);

      if (!currentItem) {
        // user is naming an item
        if (storeMap[transcript]) {
          currentItem = transcript;
          currentStep = 0;
          speak(`Okay, I will guide you to ${currentItem}. Say "next" to hear each step.`);
        } else {
          // Not in list -> suggest options
          const suggestions = availableItems.join(", ");
          speak(`This product is not available. You can choose from ${suggestions}.`);
        }
      } else {
        // already navigating
        if (transcript.includes("next")) {
          if (currentStep < storeMap[currentItem].length) {
            speak(storeMap[currentItem][currentStep]);
            currentStep++;
          } else {
            speak(`You have reached the ${currentItem} section. Happy shopping!`);
            currentItem = "";
          }
        } else if (transcript.includes("stop")) {
          speak("Navigation stopped. Happy shopping!");
          currentItem = "";
        } else {
          speak("Say 'next' for the next step or 'stop' to quit.");
        }
      }
    };

    recognition.onerror = function (event) {
      console.error(event.error);
      speak("Sorry, I could not understand. Please try again.");
    };

    // ------------ Start Button ------------
    document.getElementById("start-btn").addEventListener("click", () => {
      speak("Hello! I am your shopping assistant. What item do you want to find?");
      recognition.start();
    });

    // Keep listening continuously
    recognition.onend = function () {
      recognition.start();
    };
  </script>
</body>
</html>