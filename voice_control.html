<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multilingual Voice Control - Smart Trolley</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0b1020;
            --panel: #12172a;
            --panel-2: #0f1426;
            --text: #eef2ff;
            --muted: #9aa3b2;
            --brand: #6e9bff;
            --brand-2: #7af7d5;
            --ok: #47d18c;
            --bad: #ff6470;
            --warn: #ffd466;
            --radius: 18px;
            --shadow: 0 10px 30px rgba(0, 0, 0, .35);
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            margin: 0;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            background: radial-gradient(1200px 600px at 80% -10%, rgba(110, 155, 255, .25), transparent 60%),
                        radial-gradient(800px 400px at -10% 10%, rgba(122, 247, 213, .15), transparent 50%),
                        var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, .02), rgba(255, 255, 255, .01));
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: var(--radius);
            padding: 32px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 12px;
        }

        .subtitle {
            font-size: 16px;
            color: var(--muted);
            margin-bottom: 30px;
        }

        .language-selector {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            background: #0f1426;
            border: 1px solid rgba(255, 255, 255, .08);
            color: var(--text);
            font-size: 16px;
            margin-bottom: 20px;
        }

        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--brand), var(--brand-2));
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px auto;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(110, 155, 255, .4);
        }

        .mic-button:hover {
            transform: scale(1.05);
        }

        .mic-button.listening {
            animation: pulse 1.5s infinite;
            background: linear-gradient(135deg, var(--bad), #ff9a8b);
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 100, 112, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(255, 100, 112, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 100, 112, 0);
            }
        }

        .mic-icon {
            width: 50px;
            height: 50px;
            fill: #0b1020;
        }

        .status {
            font-size: 18px;
            font-weight: 600;
            margin: 20px 0;
            min-height: 27px;
        }

        .response {
            background: #0f1426;
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
            min-height: 100px;
        }

        .commands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .command-card {
            background: #0f1426;
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .command-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--brand);
        }

        .command-example {
            font-size: 14px;
            color: var(--muted);
        }

        .trolley-status {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: #0f1426;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, .06);
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 14px;
            color: var(--muted);
        }

        .status-value {
            font-size: 20px;
            font-weight: 700;
            margin-top: 5px;
        }

        .btn {
            appearance: none;
            border: 0;
            padding: 12px 20px;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: .2s transform, .2s filter, .2s background;
            background: linear-gradient(180deg, #1a2140, #131a34);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, .06);
            font-size: 16px;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn.primary {
            background: linear-gradient(135deg, var(--brand), var(--brand-2));
            color: #0b1020;
        }

        .actions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1 class="title">Multilingual Voice Control</h1>
            <p class="subtitle">Control your smart trolley with voice commands in 10 Indian languages</p>

            <select id="languageSelector" class="language-selector">
                <option value="en">English</option>
                <option value="hi">Hindi (हिन्दी)</option>
                <option value="ta">Tamil (தமிழ்)</option>
                <option value="te">Telugu (తెలుగు)</option>
                <option value="ml">Malayalam (മലയാളം)</option>
                <option value="kn">Kannada (ಕನ್ನಡ)</option>
                <option value="bn">Bengali (বাংলা)</option>
                <option value="mr">Marathi (मराठी)</option>
                <option value="gu">Gujarati (ગુજરાતી)</option>
                <option value="pa">Punjabi (ਪੰਜਾਬੀ)</option>
            </select>

            <div class="trolley-status">
                <div class="status-item">
                    <div class="status-label">Trolley ID</div>
                    <div class="status-value" id="trolleyId">SC1234</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Battery</div>
                    <div class="status-value" id="batteryLevel">94%</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Status</div>
                    <div class="status-value" id="trolleyStatus">Ready</div>
                </div>
            </div>

            <button id="micButton" class="mic-button">
                <svg class="mic-icon" viewBox="0 0 24 24">
                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                </svg>
            </button>

            <div id="status" class="status">Click the microphone to start speaking</div>

            <div class="response">
                <h3>Response:</h3>
                <p id="responseText">No commands received yet. Click the microphone and speak a command.</p>
            </div>

            <div class="actions">
                <button id="connectBtn" class="btn primary">Connect Trolley</button>
                <button id="disconnectBtn" class="btn">Disconnect</button>
                <button id="showCartBtn" class="btn">Show Cart</button>
            </div>

            <h2>Supported Voice Commands</h2>
            <div class="commands">
                <div class="command-card">
                    <div class="command-title">Movement</div>
                    <div class="command-example">"Move forward", "Turn left"</div>
                </div>
                <div class="command-card">
                    <div class="command-title">Speed Control</div>
                    <div class="command-example">"Faster", "Slower"</div>
                </div>
                <div class="command-card">
                    <div class="command-title">Cart Actions</div>
                    <div class="command-example">"Show cart", "Add milk"</div>
                </div>
                <div class="command-card">
                    <div class="command-title">Checkout</div>
                    <div class="command-example">"Checkout", "Pay bill"</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        const state = {
            language: "en",
            isConnected: false,
            trolleyId: "SC1234",
            batteryLevel: 94,
            isListening: false
        };

        // DOM elements
        const elements = {
            languageSelector: document.getElementById('languageSelector'),
            micButton: document.getElementById('micButton'),
            status: document.getElementById('status'),
            responseText: document.getElementById('responseText'),
            trolleyId: document.getElementById('trolleyId'),
            batteryLevel: document.getElementById('batteryLevel'),
            trolleyStatus: document.getElementById('trolleyStatus'),
            connectBtn: document.getElementById('connectBtn'),
            disconnectBtn: document.getElementById('disconnectBtn'),
            showCartBtn: document.getElementById('showCartBtn')
        };

        // Language codes for speech recognition
        const languageCodes = {
            "en": "en-US",
            "hi": "hi-IN",
            "ta": "ta-IN",
            "te": "te-IN",
            "ml": "ml-IN",
            "kn": "kn-IN",
            "bn": "bn-IN",
            "mr": "mr-IN",
            "gu": "gu-IN",
            "pa": "pa-IN"
        };

        // Initialize
        function init() {
            // Set up event listeners
            elements.languageSelector.addEventListener('change', handleLanguageChange);
            elements.micButton.addEventListener('click', toggleListening);
            elements.connectBtn.addEventListener('click', connectTrolley);
            elements.disconnectBtn.addEventListener('click', disconnectTrolley);
            elements.showCartBtn.addEventListener('click', showCart);
            
            // Update UI with initial state
            updateUI();
        }

        // Handle language change
        function handleLanguageChange(e) {
            state.language = e.target.value;
            updateStatus(`Language changed to ${e.target.options[e.target.selectedIndex].text}`);
        }

        // Toggle voice listening
        function toggleListening() {
            if (state.isListening) {
                stopListening();
            } else {
                startListening();
            }
        }

        // Start voice listening
        function startListening() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                updateStatus("Speech recognition not supported in your browser");
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = languageCodes[state.language] || "en-US";
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                state.isListening = true;
                elements.micButton.classList.add('listening');
                updateStatus("Listening... Speak now");
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                updateStatus(`You said: ${transcript}`);
                processVoiceCommand(transcript);
            };

            recognition.onerror = (event) => {
                updateStatus(`Error: ${event.error}`);
                state.isListening = false;
                elements.micButton.classList.remove('listening');
            };

            recognition.onend = () => {
                state.isListening = false;
                elements.micButton.classList.remove('listening');
                updateStatus("Listening stopped");
            };

            recognition.start();
        }

        // Stop voice listening
        function stopListening() {
            state.isListening = false;
            elements.micButton.classList.remove('listening');
            updateStatus("Listening stopped");
        }

        // Process voice command
        async function processVoiceCommand(text) {
            try {
                const response = await fetch('/api/voice-command', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        language: state.language
                    })
                });

                const data = await response.json();
                updateResponse(data.message);
                
                // Handle different actions
                switch (data.action) {
                    case 'movement':
                        updateStatus(`Trolley moving ${data.direction}`);
                        elements.trolleyStatus.textContent = `Moving ${data.direction}`;
                        // Here you would send the actual movement command to the trolley
                        break;
                    case 'speed':
                        updateStatus(`Speed ${data.change}d`);
                        elements.trolleyStatus.textContent = `Speed ${data.change}d`;
                        // Here you would send the speed change command to the trolley
                        break;
                    case 'cart':
                        elements.trolleyStatus.textContent = "Cart updated";
                        // Update cart display if needed
                        break;
                    case 'checkout':
                        elements.trolleyStatus.textContent = "Checkout";
                        // Initiate checkout process
                        break;
                    case 'help':
                        elements.trolleyStatus.textContent = "Help";
                        // Show help information
                        break;
                    case 'product_info':
                        elements.trolleyStatus.textContent = "Product Info";
                        // Show product information
                        break;
                    case 'unknown':
                        elements.trolleyStatus.textContent = "Unknown Command";
                        break;
                    case 'error':
                        elements.trolleyStatus.textContent = "Error";
                        break;
                    default:
                        elements.trolleyStatus.textContent = "Ready";
                }
            } catch (error) {
                updateResponse("Error processing command: " + error.message);
                elements.trolleyStatus.textContent = "Error";
            }
        }

        // Connect to trolley
        function connectTrolley() {
            state.isConnected = true;
            updateStatus("Connected to trolley SC1234");
            elements.trolleyStatus.textContent = "Connected";
        }

        // Disconnect from trolley
        function disconnectTrolley() {
            state.isConnected = false;
            updateStatus("Disconnected from trolley");
            elements.trolleyStatus.textContent = "Disconnected";
        }

        // Show cart
        function showCart() {
            updateResponse("Your cart contains: Milk (₹50), Bread (₹30). Total: ₹80");
            elements.trolleyStatus.textContent = "Showing cart";
        }

        // Update status message
        function updateStatus(message) {
            elements.status.textContent = message;
        }

        // Update response message
        function updateResponse(message) {
            elements.responseText.textContent = message;
        }

        // Update UI based on state
        function updateUI() {
            elements.trolleyId.textContent = state.trolleyId;
            elements.batteryLevel.textContent = state.batteryLevel + "%";
            elements.trolleyStatus.textContent = state.isConnected ? "Connected" : "Ready";
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>